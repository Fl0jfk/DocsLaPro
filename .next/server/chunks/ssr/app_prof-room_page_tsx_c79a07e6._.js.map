{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/f.hacqueville/OneDrive%20-%20LYCEE%20LA%20PROVIDENCE%20NICOLAS%20BARRE/Code/docsLaPro/app/prof-room/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { useUser } from \"@clerk/nextjs\";\r\n\r\nconst FRENCH_HOLIDAYS_2025 = [\"2025-01-01\",\"2025-04-21\",\"2025-05-01\",\"2025-05-08\",\"2025-05-29\",\"2025-06-09\",\"2025-07-14\",\"2025-08-15\",\"2025-11-01\",\"2025-11-11\",\"2025-12-25\"];\r\n\r\nfunction isWeekend(date: Date) {\r\n  const d = date.getDay();\r\n  return d === 0 || d === 6;\r\n}\r\n\r\nconst HOURS = Array.from({ length: 11 }, (_, i) => 8 + i);\r\n\r\nexport default function ProfRoomPage() {\r\n  const { user, isLoaded } = useUser();\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  const [rooms, setRooms] = useState<any[]>([]);\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  const [reservations, setReservations] = useState<any[]>([]);\r\n  const [selectedRoom, setSelectedRoom] = useState(\"\");\r\n  const [selectedDate, setSelectedDate] = useState(\"\");\r\n  const [selectedHour, setSelectedHour] = useState<number | null>(null);\r\n  const lastName = (user?.lastName ?? \"\").toUpperCase();\r\n  const ADMIN_LASTNAMES = [\"HACQUEVILLE-MATHI\",\"FORTINEAU\",\"DONA\",\"DUMOUCHEL\",\"PLANTEC\",\"GUEDIN\",\"LAINE\"];\r\n  const firstName = user?.firstName ?? \"\";\r\n  const isAdmin = ADMIN_LASTNAMES.includes(lastName);\r\n  useEffect(() => {\r\n    async function load() {\r\n      try {\r\n        const roomsRes = await fetch(\"/api/reservation-rooms/rooms\");\r\n        if (roomsRes.ok) {\r\n          const roomsData = await roomsRes.json();\r\n          setRooms(roomsData.rooms || []);\r\n        }\r\n        const resRes = await fetch(\"/api/reservation-rooms/reservations\");\r\n        if (resRes.ok) {\r\n          const resData = await resRes.json();\r\n          setReservations(resData.reservations || resData || []);\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Erreur au chargement des donnÃ©es :\", error);\r\n      }\r\n    }\r\n    load();\r\n  }, []);\r\n  if (!isLoaded) return <p className=\"p-8 text-center text-gray-500\">Chargement du profil...</p>;\r\n  if (!user) return <p className=\"p-8 text-center text-red-500 font-bold\">Veuillez vous connecter</p>;\r\n  const upcomingReservations = reservations\r\n    .filter(r => r.status !== \"CANCELLED\" && new Date(r.startsAt) >= new Date())\r\n    .sort((a, b) => new Date(a.startsAt).getTime() - new Date(b.startsAt).getTime());\r\n  function getReservation(hour: number) {\r\n    return reservations.find(\r\n      (r) =>\r\n        r.roomId === selectedRoom &&\r\n        r.startsAt.startsWith(selectedDate) &&\r\n        r.status !== \"CANCELLED\" &&\r\n        new Date(r.startsAt).getHours() === hour\r\n    );\r\n  }\r\n  async function handleConfirm() {\r\n    if (selectedHour === null || !selectedRoom || !selectedDate) return;\r\n    const start = new Date(`${selectedDate}T${selectedHour.toString().padStart(2, \"0\")}:30`);\r\n    if (isWeekend(start) || FRENCH_HOLIDAYS_2025.includes(selectedDate)) {\r\n      alert(\"â›”ï¸ Impossible de rÃ©server un week-end ou jour fÃ©riÃ©.\");\r\n      return;\r\n    }\r\n    const end = new Date(start.getTime() + 60 * 60 * 1000);\r\n    const res = await fetch(\"/api/reservation-rooms/reservations/create\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        roomId: selectedRoom,\r\n        startsAt: start.toISOString(),\r\n        endsAt: end.toISOString(),\r\n        firstName: firstName,\r\n        lastName: lastName,\r\n        email: user?.primaryEmailAddress?.emailAddress\r\n      }),\r\n    });\r\n    if (res.ok) {\r\n      alert(\"âœ… RÃ©servation confirmÃ©e !\");\r\n      const newRes = await res.json();\r\n      setReservations([...reservations, newRes.reservation]);\r\n      setSelectedHour(null);\r\n    } else {\r\n      const err = await res.json();\r\n      alert(\"Erreur : \" + (err.error || \"inconnue\"));\r\n    }\r\n  }\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  async function handleDeleteReservation(reservation: any) {\r\n    const reason = prompt(\r\n      `Motif de l'annulation pour ${reservation.firstName} ${reservation.lastName} :`, \r\n      \"IndisponibilitÃ© exceptionnelle de la salle\"\r\n    );\r\n    if (reason === null) return; \r\n    if (!confirm(\"Confirmer la suppression et l'envoi du mail d'alerte ?\")) return;\r\n    const res = await fetch(\"/api/reservation-rooms/reservations/delete\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ \r\n        startsAt: reservation.startsAt,\r\n        reason: reason,\r\n        userEmail: reservation.email\r\n      }),\r\n    });\r\n    if (res.ok) {\r\n      alert(\"ðŸ—‘ï¸ RÃ©servation annulÃ©e.\");\r\n      setReservations(reservations.filter((r) => r.startsAt !== reservation.startsAt));\r\n    } else {\r\n      const err = await res.json();\r\n      alert(\"Erreur : \" + (err.error || \"inconnue\"));\r\n    }\r\n  }\r\n  return (\r\n    <div className=\"p-4 max-w-2xl mx-auto space-y-8\">\r\n      {isAdmin && (\r\n        <div className=\"bg-white border-2 border-purple-100 rounded-2xl shadow-sm overflow-hidden\">\r\n          <div className=\"bg-purple-600 p-4 flex justify-between items-center text-white\">\r\n            <h2 className=\"font-bold text-lg\">Prochaines RÃ©servations</h2>\r\n            <span className=\"text-xs bg-purple-500 px-2 py-1 rounded-full uppercase font-bold tracking-tighter\">Admin Mode</span>\r\n          </div>\r\n          <div className=\"max-h-[300px] overflow-y-auto p-2 space-y-2\">\r\n            {upcomingReservations.length === 0 ? (\r\n              <p className=\"p-4 text-center text-gray-400 italic\">Aucune rÃ©servation Ã  venir.</p>\r\n            ) : (\r\n              upcomingReservations.map((res) => (\r\n                <div key={res.id} className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-100 hover:border-purple-200 transition-colors\">\r\n                  <div className=\"flex-1 min-w-0\">\r\n                    <p className=\"text-sm font-bold text-gray-800\">\r\n                      {new Date(res.startsAt).toLocaleDateString(\"fr-FR\", { weekday: 'short', day: 'numeric', month: 'short' })} Ã  {new Date(res.startsAt).getHours()}h30\r\n                    </p>\r\n                    <p className=\"text-xs text-gray-500 truncate\">\r\n                      ðŸ“ {rooms.find(r => r.id === res.roomId)?.name || res.roomId} â€” ðŸ‘¤ {res.firstName} {res.lastName}\r\n                    </p>\r\n                  </div>\r\n                  <button onClick={() => handleDeleteReservation(res)} className=\"ml-4 px-3 py-1 bg-red-100 text-red-600 text-[10px] font-bold rounded uppercase hover:bg-red-600 hover:text-white transition\">Annuler</button>\r\n                </div>\r\n              ))\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n      <div className=\"bg-white border rounded-2xl shadow-sm p-6\">\r\n        <h1 className=\"text-2xl font-bold mb-6 text-gray-800\">RÃ©server une salle</h1>\r\n        <div className=\"space-y-4 bg-gray-50 p-4 rounded-xl border mb-6\">\r\n          <div>\r\n            <label className=\"block mb-1 text-sm font-bold text-gray-600\">SÃ©lectionner la salle</label>\r\n            <select value={selectedRoom} onChange={(e) => setSelectedRoom(e.target.value)} className=\"border-gray-200 rounded-lg w-full p-2.5 text-black bg-white focus:ring-2 focus:ring-blue-500 outline-none\">\r\n              <option value=\"\">-- Choisir une salle --</option>\r\n              {rooms.map((r) => (\r\n                <option key={r.id} value={r.id}>{r.name}</option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n          <div>\r\n            <label className=\"block mb-1 text-sm font-bold text-gray-600\">Choisir la date</label>\r\n            <input type=\"date\"  value={selectedDate}  min={new Date().toISOString().split(\"T\")[0]}  onChange={(e) => setSelectedDate(e.target.value)}  className=\"border-gray-200 rounded-lg w-full p-2.5 text-black bg-white focus:ring-2 focus:ring-blue-500 outline-none\"/>\r\n          </div>\r\n        </div>\r\n        {selectedRoom && selectedDate && (\r\n          <div className=\"animate-in slide-in-from-bottom-2 duration-300\">\r\n            <h2 className=\"font-bold mb-3 text-gray-700\">Grille horaire</h2>\r\n            <div className=\"grid grid-cols-2 gap-3 mb-6\">\r\n              {HOURS.map((hour) => {\r\n                const res = getReservation(hour);\r\n                const isBooked = !!res;\r\n                const isSelected = selectedHour === hour;\r\n                return (\r\n                  <div key={hour} className={`flex flex-col border rounded-xl p-2 transition-all ${isBooked ? 'bg-gray-50 border-gray-100' : 'bg-white border-gray-200 shadow-sm'}`}>\r\n                    <button  disabled={isBooked} onClick={() => setSelectedHour(hour)}  className={`p-2 rounded-lg text-sm font-bold text-white transition-all ${ isBooked ? \"bg-gray-300 cursor-not-allowed\" : isSelected ? \"bg-green-600 ring-4 ring-green-100\" : \"bg-blue-600 hover:bg-blue-700\"}`}>{hour}:30 - {hour + 1}:30</button>\r\n                    {isBooked && (\r\n                      <div className=\"mt-2 text-center\">\r\n                        <p className=\"text-[10px] text-gray-500 font-bold truncate\">ðŸ“Œ {res.firstName} {res.lastName}</p>\r\n                        {isAdmin && (\r\n                          <button onClick={() => handleDeleteReservation(res)} className=\"mt-1 w-full text-[9px] font-bold text-red-500 uppercase hover:underline\">Annuler & PrÃ©venir</button>\r\n                        )}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n            {selectedHour !== null && (\r\n              <button onClick={handleConfirm} className=\"w-full px-4 py-4 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 transition shadow-lg transform active:scale-95\">Confirmer pour {selectedHour}:30</button>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}