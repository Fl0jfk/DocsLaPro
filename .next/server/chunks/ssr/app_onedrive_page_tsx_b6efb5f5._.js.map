{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/f.hacqueville/OneDrive%20-%20LYCEE%20LA%20PROVIDENCE%20NICOLAS%20BARRE/Code/docsLaPro/app/onedrive/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useState, useEffect } from \"react\";\r\nimport * as msal from \"@azure/msal-browser\";\r\n\r\nconst msalConfig: msal.Configuration = {\r\n  auth: {\r\n    clientId: process.env.NEXT_PUBLIC_CLIENT_ID!,\r\n    authority: `https://login.microsoftonline.com/${process.env.NEXT_PUBLIC_TENANT_ID}`,\r\n    redirectUri: `${process.env.NEXT_PUBLIC_APP_URL}onedrive`,\r\n  },\r\n};\r\n\r\nconst msalInstance = new msal.PublicClientApplication(msalConfig);\r\n\r\nexport default function OneDriveUpDocsOCRAI() {\r\n  const [account, setAccount] = useState<msal.AccountInfo | null>(null);\r\n  const [files, setFiles] = useState<any[]>([]);\r\n  const [error, setError] = useState(\"\");\r\n  const [msalReady, setMsalReady] = useState(false);\r\n  const [currentFolder, setCurrentFolder] = useState<string | null>(null);\r\n  const [currentFolderPath, setCurrentFolderPath] = useState<string>(\"\");\r\n  const [ocrProcessing, setOcrProcessing] = useState(false);\r\n  const [ocrResults, setOcrResults] = useState<any[]>([]);\r\n  const [processingStatus, setProcessingStatus] = useState<{total: number, completed: number, failed: number}>({\r\n    total: 0,\r\n    completed: 0,\r\n    failed: 0\r\n  });\r\n\r\n  useEffect(() => {\r\n    const init = async () => {\r\n      try {\r\n        await msalInstance.initialize(); \r\n        setMsalReady(true);\r\n        const accounts = msalInstance.getAllAccounts();\r\n        if (accounts.length > 0) {\r\n          setAccount(accounts[0]);\r\n          const token = await getAccessToken(accounts[0]);\r\n          fetchFiles(token, null, \"\");\r\n        }\r\n      } catch (err: any) {\r\n        setError(\"Erreur init MSAL: \" + err.message);\r\n      }\r\n    };\r\n    init();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!msalReady) return;\r\n    const handleRedirect = async () => {\r\n      try {\r\n        const result = await msalInstance.handleRedirectPromise();\r\n        if (result?.account) {\r\n          setAccount(result.account);\r\n          const token = await getAccessToken(result.account);\r\n          fetchFiles(token, null, \"\");\r\n        }\r\n      } catch (err: any) {\r\n        setError(\"Erreur login redirect: \" + err.message);\r\n      }\r\n    };\r\n    handleRedirect();\r\n  }, [msalReady]);\r\n\r\n  const login = async () => {\r\n    if (!msalReady) {\r\n      setError(\"MSAL n'est pas encore initialis√©.\");\r\n      return;\r\n    }\r\n    try {\r\n      await msalInstance.loginRedirect({\r\n        scopes: [\"Files.ReadWrite\", \"User.Read\"],\r\n      });\r\n    } catch (err: any) {\r\n      setError(\"Erreur login: \" + err.message);\r\n    }\r\n  };\r\n\r\n  const getAccessToken = async (acc?: msal.AccountInfo) => {\r\n    const usedAccount = acc || account;\r\n    if (!usedAccount) throw new Error(\"Aucun compte connect√©\");\r\n    const tokenResponse = await msalInstance.acquireTokenSilent({\r\n      account: usedAccount,\r\n      scopes: [\"Files.ReadWrite\", \"User.Read\"],\r\n    });\r\n    return tokenResponse.accessToken;\r\n  };\r\n\r\n  const fetchFiles = async (accessToken: string, folderId: string | null, folderPath: string) => {\r\n    try {\r\n      const url = folderId \r\n        ? `https://graph.microsoft.com/v1.0/me/drive/items/${folderId}/children` \r\n        : folderPath \r\n        ? `https://graph.microsoft.com/v1.0/me/drive/root:/${folderPath}:/children` \r\n        : \"https://graph.microsoft.com/v1.0/me/drive/root/children\";\r\n      \r\n      const res = await fetch(url, {\r\n        headers: { Authorization: `Bearer ${accessToken}` },\r\n      });\r\n      if (!res.ok) throw new Error(await res.text());\r\n      const data = await res.json();\r\n      setFiles(data.value || []);\r\n      setCurrentFolder(folderId);\r\n      setCurrentFolderPath(folderPath);\r\n    } catch (err: any) {\r\n      setError(\"Erreur Graph API: \" + err.message);\r\n    }\r\n  };\r\n\r\n  const handleUpload = async (file: File) => {\r\n    if (!file || !account) return;\r\n    try {\r\n      const accessToken = await getAccessToken();\r\n      const uploadPath = currentFolderPath ? `${currentFolderPath}/${file.name}` : file.name;\r\n      const res = await fetch(\r\n        `https://graph.microsoft.com/v1.0/me/drive/root:/${uploadPath}:/content`,\r\n        {\r\n          method: \"PUT\",\r\n          headers: {\r\n            Authorization: `Bearer ${accessToken}`,\r\n            \"Content-Type\": file.type || \"application/octet-stream\",\r\n          },\r\n          body: file,\r\n        }\r\n      );\r\n      if (!res.ok) throw new Error(await res.text());\r\n      await fetchFiles(accessToken, currentFolder, currentFolderPath);\r\n      alert(\"Upload termin√© !\");\r\n    } catch (err: any) {\r\n      setError(\"Erreur upload: \" + err.message);\r\n    }\r\n  };\r\n\r\n  const openFile = async (file: any) => {\r\n    if (file.folder) {\r\n      const token = await getAccessToken();\r\n      const newPath = currentFolderPath ? `${currentFolderPath}/${file.name}` : file.name;\r\n      fetchFiles(token, file.id, newPath);\r\n    } else {\r\n      window.open(file.webUrl, \"_blank\");\r\n    }\r\n  };\r\n\r\n  // Fonction helper pour traiter par lots\r\n  async function processInBatches<T, R>(\r\n    items: T[],\r\n    batchSize: number,\r\n    processFn: (item: T) => Promise<R>\r\n  ): Promise<R[]> {\r\n    const results: R[] = [];\r\n    \r\n    for (let i = 0; i < items.length; i += batchSize) {\r\n      const batch = items.slice(i, i + batchSize);\r\n      const batchResults = await Promise.all(batch.map(processFn));\r\n      results.push(...batchResults);\r\n      \r\n      // Mettre √† jour le statut apr√®s chaque lot\r\n      const currentCompleted = results.filter((r: any) => r.success).length;\r\n      const currentFailed = results.filter((r: any) => !r.success).length;\r\n      setProcessingStatus(prev => ({ \r\n        total: prev.total, \r\n        completed: currentCompleted, \r\n        failed: currentFailed \r\n      }));\r\n      \r\n      // Petit d√©lai entre les lots pour √©viter le rate limiting\r\n      if (i + batchSize < items.length) {\r\n        await new Promise(r => setTimeout(r, 2000));\r\n      }\r\n    }\r\n    \r\n    return results;\r\n  }\r\n\r\n  // Fonction pour traiter un seul fichier\r\n  const processSingleFile = async (file: File): Promise<{success: boolean, result?: any, error?: string, fileName: string}> => {\r\n    try {\r\n      // 1. Upload vers S3\r\n      const r1 = await fetch(\"/api/upload-url\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ filename: file.name, contentType: file.type }),\r\n      });\r\n      if (!r1.ok) throw new Error(await r1.text());\r\n      const { url, key } = await r1.json();\r\n\r\n      const upload = await fetch(url, {\r\n        method: \"PUT\",\r\n        headers: { \"Content-Type\": file.type },\r\n        body: file,\r\n      });\r\n      if (!upload.ok) throw new Error(\"√âchec upload S3 : \" + (await upload.text()));\r\n\r\n      // 2. Lancer OCR Textract\r\n      const r2 = await fetch(\"/api/ocr-process\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ key }),\r\n      });\r\n      if (!r2.ok) throw new Error(await r2.text());\r\n      const { jobId } = await r2.json();\r\n      if (!jobId) throw new Error(\"Impossible de lancer Textract\");\r\n\r\n      // 3. Attendre le r√©sultat OCR\r\n      let extractedText = \"\";\r\n      for (let i = 0; i < 30; i++) {\r\n        const r3 = await fetch(\"/api/ocr-result\", {\r\n          method: \"POST\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify({ jobId }),\r\n        });\r\n        if (!r3.ok) throw new Error(await r3.text());\r\n        const data = await r3.json();\r\n        if (data.text) {\r\n          extractedText = data.text;\r\n          break;\r\n        }\r\n        if (data.status === \"IN_PROGRESS\") {\r\n          await new Promise(r => setTimeout(r, 5000));\r\n        } else {\r\n          throw new Error(\"OCR Textract a √©chou√© : \" + JSON.stringify(data));\r\n        }\r\n      }\r\n      if (!extractedText) throw new Error(\"Timeout OCR : aucun texte retourn√©\");\r\n\r\n      // 4. Analyse IA\r\n      const r4 = await fetch(\"/api/analyze-doc\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ text: extractedText }),\r\n      });\r\n      if (!r4.ok) throw new Error(await r4.text());\r\n      // Dans processSingleFile, apr√®s l'appel √† /api/analyze-doc\r\nconst ai = await r4.json();\r\n\r\n// Utiliser le fileName g√©n√©r√© par Mistral\r\nif (ai?.fileName && ai?.eleve?.nom && ai?.eleve?.pr√©nom) {\r\n  const newFileName = `${ai.fileName}.pdf`;\r\n  \r\n  const accessToken = await getAccessToken();\r\n  const uploadPath = currentFolderPath ? `${currentFolderPath}/${newFileName}` : newFileName;\r\n  \r\n  const fileRes = await fetch(`https://graph.microsoft.com/v1.0/me/drive/root:/${uploadPath}:/content`,\r\n    {\r\n      method: \"PUT\",\r\n      headers: {\r\n        Authorization: `Bearer ${accessToken}`,\r\n        \"Content-Type\": file.type || \"application/pdf\",\r\n      },\r\n      body: file,\r\n    }\r\n  );\r\n  if (!fileRes.ok) throw new Error(\"Erreur upload OneDrive : \" + (await fileRes.text()));\r\n}\r\n      return { success: true, result: ai, fileName: file.name };\r\n    } catch (err: any) {\r\n      console.error(`Erreur pour ${file.name}:`, err);\r\n      return { success: false, error: err.message, fileName: file.name };\r\n    }\r\n  };\r\n\r\n  // Fonction pour g√©rer plusieurs fichiers\r\n  const handleMultipleOcrUploadAndAnalyse = async (fileList: FileList | null) => {\r\n    if (!fileList || fileList.length === 0) return;\r\n\r\n    const filesArray = Array.from(fileList);\r\n    \r\n    try {\r\n      setOcrProcessing(true);\r\n      setError(\"\");\r\n      setOcrResults([]);\r\n      setProcessingStatus({ total: filesArray.length, completed: 0, failed: 0 });\r\n\r\n      // Traiter par lots de 2 documents √† la fois pour AWS Textract\r\n      const results = await processInBatches(\r\n        filesArray,\r\n        2,\r\n        processSingleFile\r\n      );\r\n\r\n      // Compter les succ√®s et √©checs\r\n      const completed = results.filter(r => r.success).length;\r\n      const failed = results.filter(r => !r.success).length;\r\n      \r\n      setProcessingStatus({ total: filesArray.length, completed, failed });\r\n      setOcrResults(results);\r\n\r\n      // Rafra√Æchir la liste des fichiers OneDrive\r\n      const accessToken = await getAccessToken();\r\n      await fetchFiles(accessToken, currentFolder, currentFolderPath);\r\n\r\n      alert(`Traitement termin√©!\\n‚úÖ R√©ussis: ${completed}\\n‚ùå √âchecs: ${failed}`);\r\n    } catch (err: any) {\r\n      console.error(err);\r\n      setError(\"Erreur globale OCR / Analyse: \" + err.message);\r\n    } finally {\r\n      setOcrProcessing(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-4 max-w-[80%] mx-auto\">\r\n      <h2 className=\"text-2xl font-bold mb-4\">Mon OneDrive</h2>\r\n      {error && <p className=\"text-red-500 mb-2\">{error}</p>}\r\n      \r\n      {!account ? (\r\n        <button onClick={login} className=\"p-2 bg-blue-600 text-white rounded mt-2\">\r\n          Se connecter √† OneDrive\r\n        </button>\r\n      ) : (\r\n        <>\r\n          <div className=\"flex gap-2 mb-4\">\r\n            <label className=\"p-2 bg-green-500 text-white rounded cursor-pointer\">\r\n              Choisir un fichier\r\n              <input\r\n                type=\"file\"\r\n                className=\"hidden\"\r\n                onChange={(e) => e.target.files?.[0] && handleUpload(e.target.files[0])}\r\n              />\r\n            </label>\r\n          </div>\r\n\r\n          <div className=\"flex gap-2 mb-4\">\r\n            <label className=\"p-2 bg-purple-500 text-white rounded cursor-pointer\">\r\n              Envoyer plusieurs fichiers pour OCR + Analyse\r\n              <input\r\n                type=\"file\"\r\n                className=\"hidden\"\r\n                multiple\r\n                onChange={(e) => handleMultipleOcrUploadAndAnalyse(e.target.files)}\r\n                disabled={ocrProcessing}\r\n              />\r\n            </label>\r\n            {ocrProcessing && (\r\n              <div className=\"ml-2 flex items-center gap-2\">\r\n                <span>Traitement en cours‚Ä¶</span>\r\n                <span className=\"text-sm text-gray-600\">\r\n                  ({processingStatus.completed + processingStatus.failed}/{processingStatus.total})\r\n                </span>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {ocrResults.length > 0 && (\r\n            <div className=\"mb-4\">\r\n              <h3 className=\"font-bold mb-2\">R√©sultats du traitement:</h3>\r\n              <div className=\"space-y-2 max-h-96 overflow-y-auto\">\r\n                {ocrResults.map((result, index) => (\r\n                  <div \r\n                    key={index} \r\n                    className={`p-3 rounded ${result.success ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200'}`}\r\n                  >\r\n                    <div className=\"font-semibold flex items-center gap-2\">\r\n                      {result.success ? '‚úÖ' : '‚ùå'} {result.fileName}\r\n                    </div>\r\n                    {result.success ? (\r\n                      <pre className=\"text-xs bg-white p-2 rounded mt-2 overflow-x-auto\">\r\n                        {JSON.stringify(result.result, null, 2)}\r\n                      </pre>\r\n                    ) : (\r\n                      <p className=\"text-red-600 text-sm mt-1\">{result.error}</p>\r\n                    )}\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {currentFolderPath && (\r\n            <button \r\n              onClick={async () => { \r\n                const token = await getAccessToken(); \r\n                const parentPath = currentFolderPath.split(\"/\").slice(0, -1).join(\"\"); \r\n                fetchFiles(token, null, parentPath);\r\n              }}\r\n              className=\"mb-2 text-blue-500 underline\"\r\n            >\r\n              ‚Üê Revenir √† la racine\r\n            </button>\r\n          )}\r\n\r\n          <ul className=\"border rounded p-2 space-y-1 bg-gray-50\">\r\n            {files.map((f) => (\r\n              <li \r\n                key={f.id || f.name} \r\n                className=\"flex items-center gap-2 p-2 hover:bg-gray-100 cursor-pointer rounded\" \r\n                onClick={() => openFile(f)}\r\n              >\r\n                {f.folder ? \"üìÅ\" : \"üìÑ\"} {f.name}\r\n              </li>\r\n            ))}\r\n          </ul>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}