{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/f.hacqueville/OneDrive%20-%20LYCEE%20LA%20PROVIDENCE%20NICOLAS%20BARRE/Code/docsLaPro/app/documents/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport Link from \"next/link\";\r\n\r\ntype DocumentNode = {\r\n  type: \"folder\" | \"file\";\r\n  name: string;\r\n  url?: string;\r\n  path: string;\r\n  ext?: string;\r\n};\r\n\r\nexport default function DocumentsPage() {\r\n  const [currentPrefix, setCurrentPrefix] = useState(\"\");\r\n  const [items, setItems] = useState<DocumentNode[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [history, setHistory] = useState<string[]>([]);\r\n  const cacheKey = (prefix: string) => `documents_cache_${prefix}`;\r\n  const cacheTTL = 24 * 60 * 60 * 1000;\r\n  useEffect(() => {\r\n    setLoading(true);\r\n    const cachedRaw = localStorage.getItem(cacheKey(currentPrefix));\r\n    if (cachedRaw) {\r\n      const cached = JSON.parse(cachedRaw);\r\n      const now = Date.now();\r\n      if (now - cached.timestamp < cacheTTL) {\r\n        setItems(cached.data);\r\n        setLoading(false);\r\n        return;\r\n      }\r\n    }\r\n    fetch(`/api/documents/list?prefix=${currentPrefix}`)\r\n      .then(res => res.json())\r\n      .then(data => {\r\n        if (data.error) {\r\n          console.error(\"Erreur API documents:\", data.error);\r\n          setItems([]);\r\n        } else {\r\n          setItems(data);\r\n          localStorage.setItem(cacheKey(currentPrefix), JSON.stringify({\r\n            data,\r\n            timestamp: Date.now(),\r\n          }));\r\n        }\r\n        setLoading(false);\r\n      })\r\n      .catch(err => {\r\n        console.error(\"Erreur fetch documents:\", err);\r\n        setLoading(false);\r\n      });\r\n  }, [currentPrefix]);\r\n  const enterFolder = (path: string) => {\r\n    setHistory(prev => [...prev, currentPrefix]);\r\n    setCurrentPrefix(path.replace(/^documents\\/[^/]+\\//, \"\"));\r\n  };\r\n  const goBack = () => {\r\n    const prev = history.pop();\r\n    if (prev !== undefined) {\r\n      setHistory([...history]);\r\n      setCurrentPrefix(prev);\r\n    }\r\n  };\r\n  const getFileIcon = (ext?: string) => {\r\n    if (!ext) return \"üìÑ\";\r\n    if (ext === \"pdf\") return \"üìÑ\";\r\n    if (ext === \"doc\" || ext === \"docx\") return \"üìù\";\r\n    if (ext === \"xls\" || ext === \"xlsx\") return \"üìä\";\r\n    return \"üìÑ\";\r\n  };\r\n  if (loading) return <div>Chargement...</div>;\r\n  return (\r\n    <main className=\"flex flex-col gap-4 p-4 w-full mx-auto max-w-[1000px] sm:pt-[10vh]\">\r\n      <section className=\"space-y-4 flex flex-col gap-2\">\r\n        {history.length > 0 && (\r\n          <button onClick={goBack} className=\"text-blue-500 hover:underline mb-4\">‚Üê Retour</button>\r\n        )}\r\n        {items.length > 0 ? (\r\n          items.map((item, idx) => (\r\n            <div key={idx} className=\"p-4 bg-white rounded-lg shadow-md\">\r\n              {item.type === \"folder\" ? (\r\n                <div className=\"cursor-pointer font-semibold text-yellow-700\" onClick={() => enterFolder(item.path)}>\r\n                  üìÅ {item.name}\r\n                </div>\r\n              ) : (\r\n                <div className=\"flex justify-between\">\r\n                  <h3 className=\"font-semibold\">{getFileIcon(item.ext)} {item.name}</h3>\r\n                  <Link className=\"text-blue-500 hover:underline\" href={item.url!}>T√©l√©charger</Link>\r\n                </div>\r\n              )}\r\n            </div>\r\n          ))\r\n        ) : (\r\n          <p>Aucun document disponible pour ce dossier.</p>\r\n        )}\r\n      </section>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AAHA;;;;AAae,SAAS;IACtB,MAAM,CAAC,eAAe,iBAAiB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACnD,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAkB,EAAE;IACrD,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACvC,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAY,EAAE;IACnD,MAAM,WAAW,CAAC,SAAmB,CAAC,gBAAgB,EAAE,QAAQ;IAChE,MAAM,WAAW,KAAK,KAAK,KAAK;IAChC,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,WAAW;QACX,MAAM,YAAY,aAAa,OAAO,CAAC,SAAS;QAChD,IAAI,WAAW;YACb,MAAM,SAAS,KAAK,KAAK,CAAC;YAC1B,MAAM,MAAM,KAAK,GAAG;YACpB,IAAI,MAAM,OAAO,SAAS,GAAG,UAAU;gBACrC,SAAS,OAAO,IAAI;gBACpB,WAAW;gBACX;YACF;QACF;QACA,MAAM,CAAC,2BAA2B,EAAE,eAAe,EAChD,IAAI,CAAC,CAAA,MAAO,IAAI,IAAI,IACpB,IAAI,CAAC,CAAA;YACJ,IAAI,KAAK,KAAK,EAAE;gBACd,QAAQ,KAAK,CAAC,yBAAyB,KAAK,KAAK;gBACjD,SAAS,EAAE;YACb,OAAO;gBACL,SAAS;gBACT,aAAa,OAAO,CAAC,SAAS,gBAAgB,KAAK,SAAS,CAAC;oBAC3D;oBACA,WAAW,KAAK,GAAG;gBACrB;YACF;YACA,WAAW;QACb,GACC,KAAK,CAAC,CAAA;YACL,QAAQ,KAAK,CAAC,2BAA2B;YACzC,WAAW;QACb;IACJ,GAAG;QAAC;KAAc;IAClB,MAAM,cAAc,CAAC;QACnB,WAAW,CAAA,OAAQ;mBAAI;gBAAM;aAAc;QAC3C,iBAAiB,KAAK,OAAO,CAAC,uBAAuB;IACvD;IACA,MAAM,SAAS;QACb,MAAM,OAAO,QAAQ,GAAG;QACxB,IAAI,SAAS,WAAW;YACtB,WAAW;mBAAI;aAAQ;YACvB,iBAAiB;QACnB;IACF;IACA,MAAM,cAAc,CAAC;QACnB,IAAI,CAAC,KAAK,OAAO;QACjB,IAAI,QAAQ,OAAO,OAAO;QAC1B,IAAI,QAAQ,SAAS,QAAQ,QAAQ,OAAO;QAC5C,IAAI,QAAQ,SAAS,QAAQ,QAAQ,OAAO;QAC5C,OAAO;IACT;IACA,IAAI,SAAS,qBAAO,8OAAC;kBAAI;;;;;;IACzB,qBACE,8OAAC;QAAK,WAAU;kBACd,cAAA,8OAAC;YAAQ,WAAU;;gBAChB,QAAQ,MAAM,GAAG,mBAChB,8OAAC;oBAAO,SAAS;oBAAQ,WAAU;8BAAqC;;;;;;gBAEzE,MAAM,MAAM,GAAG,IACd,MAAM,GAAG,CAAC,CAAC,MAAM,oBACf,8OAAC;wBAAc,WAAU;kCACtB,KAAK,IAAI,KAAK,yBACb,8OAAC;4BAAI,WAAU;4BAA+C,SAAS,IAAM,YAAY,KAAK,IAAI;;gCAAG;gCAC/F,KAAK,IAAI;;;;;;iDAGf,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCAAG,WAAU;;wCAAiB,YAAY,KAAK,GAAG;wCAAE;wCAAE,KAAK,IAAI;;;;;;;8CAChE,8OAAC,4JAAA,CAAA,UAAI;oCAAC,WAAU;oCAAgC,MAAM,KAAK,GAAG;8CAAG;;;;;;;;;;;;uBAR7D;;;;8CAcZ,8OAAC;8BAAE;;;;;;;;;;;;;;;;;AAKb","debugId":null}}]
}