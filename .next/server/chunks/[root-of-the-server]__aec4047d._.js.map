{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 127, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/f.hacqueville/OneDrive%20-%20LYCEE%20LA%20PROVIDENCE%20NICOLAS%20BARRE/Code/docsLaPro/app/api/onedrive/route.ts"],"sourcesContent":["import { NextApiRequest, NextApiResponse } from \"next\";\r\nimport fetch from \"node-fetch\";\r\n\r\nconst TENANT_ID = process.env.TENANT_ID!;\r\nconst CLIENT_ID = process.env.CLIENT_ID!;\r\nconst CLIENT_SECRET = process.env.CLIENT_SECRET!;\r\n\r\n// Récupération d'un token OAuth\r\nasync function getToken() {\r\n  const url = `https://login.microsoftonline.com/${TENANT_ID}/oauth2/v2.0/token`;\r\n  const params = new URLSearchParams();\r\n  params.append(\"grant_type\", \"client_credentials\");\r\n  params.append(\"client_id\", CLIENT_ID);\r\n  params.append(\"client_secret\", CLIENT_SECRET);\r\n  params.append(\"scope\", \"https://graph.microsoft.com/.default\");\r\n\r\n  const res = await fetch(url, { method: \"POST\", body: params });\r\n  const data: any = await res.json();\r\n  return data.access_token;\r\n}\r\n\r\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\r\n  const token = await getToken();\r\n\r\n  if (req.method === \"GET\") {\r\n    // Lister les fichiers de la racine OneDrive\r\n    const apiRes = await fetch(\"https://graph.microsoft.com/v1.0/me/drive/root/children\", {\r\n      headers: { Authorization: `Bearer ${token}` },\r\n    });\r\n    const data = await apiRes.json();\r\n    return res.status(200).json(data);\r\n  }\r\n\r\n  if (req.method === \"POST\") {\r\n    const { filename, content } = req.body;\r\n    if (!filename || !content) return res.status(400).json({ error: \"Missing filename or content\" });\r\n\r\n    const apiRes = await fetch(\r\n      `https://graph.microsoft.com/v1.0/me/drive/root:/${filename}:/content`,\r\n      {\r\n        method: \"PUT\",\r\n        headers: { Authorization: `Bearer ${token}` },\r\n        body: content,\r\n      }\r\n    );\r\n    const data = await apiRes.json();\r\n    return res.status(200).json(data);\r\n  }\r\n\r\n  res.status(405).json({ error: \"Method not allowed\" });\r\n}\r\n"],"names":[],"mappings":";;;;AACA;;AAEA,MAAM,YAAY,QAAQ,GAAG,CAAC,SAAS;AACvC,MAAM,YAAY,QAAQ,GAAG,CAAC,SAAS;AACvC,MAAM,gBAAgB,QAAQ,GAAG,CAAC,aAAa;AAE/C,gCAAgC;AAChC,eAAe;IACb,MAAM,MAAM,CAAC,kCAAkC,EAAE,UAAU,kBAAkB,CAAC;IAC9E,MAAM,SAAS,IAAI;IACnB,OAAO,MAAM,CAAC,cAAc;IAC5B,OAAO,MAAM,CAAC,aAAa;IAC3B,OAAO,MAAM,CAAC,iBAAiB;IAC/B,OAAO,MAAM,CAAC,SAAS;IAEvB,MAAM,MAAM,MAAM,IAAA,0KAAK,EAAC,KAAK;QAAE,QAAQ;QAAQ,MAAM;IAAO;IAC5D,MAAM,OAAY,MAAM,IAAI,IAAI;IAChC,OAAO,KAAK,YAAY;AAC1B;AAEe,eAAe,QAAQ,GAAmB,EAAE,GAAoB;IAC7E,MAAM,QAAQ,MAAM;IAEpB,IAAI,IAAI,MAAM,KAAK,OAAO;QACxB,4CAA4C;QAC5C,MAAM,SAAS,MAAM,IAAA,0KAAK,EAAC,2DAA2D;YACpF,SAAS;gBAAE,eAAe,CAAC,OAAO,EAAE,OAAO;YAAC;QAC9C;QACA,MAAM,OAAO,MAAM,OAAO,IAAI;QAC9B,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;IAC9B;IAEA,IAAI,IAAI,MAAM,KAAK,QAAQ;QACzB,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE,GAAG,IAAI,IAAI;QACtC,IAAI,CAAC,YAAY,CAAC,SAAS,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAA8B;QAE9F,MAAM,SAAS,MAAM,IAAA,0KAAK,EACxB,CAAC,gDAAgD,EAAE,SAAS,SAAS,CAAC,EACtE;YACE,QAAQ;YACR,SAAS;gBAAE,eAAe,CAAC,OAAO,EAAE,OAAO;YAAC;YAC5C,MAAM;QACR;QAEF,MAAM,OAAO,MAAM,OAAO,IAAI;QAC9B,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;IAC9B;IAEA,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO;IAAqB;AACrD","debugId":null}}]
}