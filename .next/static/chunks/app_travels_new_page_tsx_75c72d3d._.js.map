{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/f.hacqueville/OneDrive%20-%20LYCEE%20LA%20PROVIDENCE%20NICOLAS%20BARRE/Code/docsLaPro/app/travels/new/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useRef, useState } from \"react\";\r\nimport { useUser } from \"@clerk/nextjs\";\r\n\r\nexport default function VoyageForm() {\r\n  const fileInput = useRef<HTMLInputElement | null>(null);\r\n  const progInput = useRef<HTMLInputElement | null>(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [result, setResult] = useState<string | null>(null);\r\n  const { user, isLoaded } = useUser();\r\n  async function handleSubmit(e: React.FormEvent) {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n    setResult(null);\r\n    const form = e.target as HTMLFormElement;\r\n    const formData = new FormData(form);\r\n    if (!user) return;\r\n    const prenom = user.firstName || \"\";\r\n    const nom = user.lastName || \"\";\r\n    const email =\r\n      user.primaryEmailAddress?.emailAddress ||\r\n      user.emailAddresses?.[0]?.emailAddress ||\r\n      \"\";\r\n    formData.set(\"prenom\", prenom);\r\n    formData.set(\"nom\", nom);\r\n    formData.set(\"email\", email);\r\n    if (fileInput.current?.files && fileInput.current.files.length > 5) {\r\n      setResult(\"Vous ne pouvez joindre que 5 fichiers maximum.\");\r\n      setLoading(false);\r\n      return;\r\n    }\r\n    if (progInput.current?.files && progInput.current.files.length > 1) {\r\n      setResult(\"Une seule pièce jointe autorisée pour le programme.\");\r\n      setLoading(false);\r\n      return;\r\n    }\r\n    const res = await fetch(\"/api/travels/create\", {\r\n      method: \"POST\",\r\n      body: formData,\r\n    });\r\n    const reponse = await res.json();\r\n    setLoading(false);\r\n    setResult(reponse.message || reponse.error);\r\n    if (fileInput.current) fileInput.current.value = \"\";\r\n    if (progInput.current) progInput.current.value = \"\";\r\n    form.reset();\r\n  }\r\n  if (!isLoaded) return <div>Chargement…</div>;\r\n  if (!user) return <div>Vous devez être connecté(e).</div>;\r\n  const prenom = user.firstName || \"\";\r\n  const nom = user.lastName || \"\";\r\n  const email =\r\n    user.primaryEmailAddress?.emailAddress ||\r\n    user.emailAddresses?.[0]?.emailAddress ||\r\n    \"\";\r\n  return (\r\n    <form onSubmit={handleSubmit} className=\"pt-[15vh] flex flex-col items-center gap-4 max-w-xl mx-auto\" encType=\"multipart/form-data\">\r\n      <h2>Demande de sortie / voyage scolaire</h2>\r\n      <label>Prénom :\r\n        <input value={prenom} readOnly style={{ background: \"#f5f5f5\" }} tabIndex={-1} />\r\n      </label>\r\n      <label>Nom :\r\n        <input value={nom} readOnly style={{ background: \"#f5f5f5\" }} tabIndex={-1} />\r\n      </label>\r\n      <label>Email :\r\n        <input value={email} readOnly style={{ background: \"#f5f5f5\" }} tabIndex={-1} />\r\n      </label>\r\n      <input type=\"hidden\" name=\"prenom\" value={prenom} />\r\n      <input type=\"hidden\" name=\"nom\" value={nom} />\r\n      <input type=\"hidden\" name=\"email\" value={email} />\r\n      <label>Établissement concerné :\r\n        <select name=\"direction_cible\" required>\r\n          <option value=\"\">Choisir…</option>\r\n          <option value=\"direction_ecole\">École</option>\r\n          <option value=\"direction_college\">Collège</option>\r\n          <option value=\"direction_lycee\">Lycée</option>\r\n        </select>\r\n      </label>\r\n      <label>Date de départ :\r\n        <input type=\"date\" name=\"date_depart\" required />\r\n      </label>\r\n      <label>Date de retour :\r\n        <input type=\"date\" name=\"date_retour\" required />\r\n      </label>\r\n      <label>Lieu / destination :\r\n        <input type=\"text\" name=\"lieu\" required />\r\n      </label>\r\n      <label>Activité / motif :\r\n        <input type=\"text\" name=\"activite\" required />\r\n      </label>\r\n      <label>Classes concernées :\r\n        <input type=\"text\" name=\"classes\" placeholder=\"Ex: 3A, 3B, ULIS…\" required />\r\n      </label>\r\n      <label>Nombre d’élèves :\r\n        <input type=\"number\" name=\"effectif_eleves\" min={1} required />\r\n      </label>\r\n      <label>Nombre d’accompagnateurs :\r\n        <input type=\"number\" name=\"effectif_accompagnateurs\" min={1} required />\r\n      </label>\r\n      <label>Programme (itinéraire/jours/destination en détail) :\r\n        <input ref={progInput} type=\"file\" name=\"programme\" accept=\".pdf,.doc,.docx,image/*\"/>\r\n      </label>\r\n      <label>Autres pièces jointes (5 max) :\r\n        <input ref={fileInput} type=\"file\" name=\"pj\" multiple accept=\"image/*,.pdf\" max={5}/>\r\n      </label>\r\n      <label>Commentaire:\r\n        <textarea name=\"commentaire\" />\r\n      </label>\r\n      <button type=\"submit\" disabled={loading} style={{ marginTop: 15 }}>\r\n        {loading ? \"Traitement…\" : \"Soumettre la demande\"}\r\n      </button>\r\n      {result && <div style={{ marginTop: 12 }}>{result}</div>}\r\n    </form>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}