{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/f.hacqueville/OneDrive%20-%20LYCEE%20LA%20PROVIDENCE%20NICOLAS%20BARRE/Code/docsLaPro/app/absences/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useRef, useState } from \"react\";\r\nimport { useUser } from \"@clerk/nextjs\";\r\n\r\nexport default function AbsenceDeclarationForm() {\r\n  const fileInput = useRef<HTMLInputElement | null>(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [result, setResult] = useState<string | null>(null);\r\n  const { user, isLoaded } = useUser();\r\n\r\n  async function handleSubmit(e: React.FormEvent) {\r\n    e.preventDefault();\r\n    if (!user) return;\r\n    setLoading(true);\r\n    setResult(null);\r\n    try {\r\n      const form = e.target as HTMLFormElement;\r\n      const formData = new FormData(form);\r\n      const prenomClerk = user.firstName || \"\";\r\n      const nomClerk = user.lastName || \"\";\r\n      const emailClerk =\r\n        user.primaryEmailAddress?.emailAddress ||\r\n        user.emailAddresses?.[0]?.emailAddress ||\r\n        \"\";\r\n      formData.set(\"nom\", `${prenomClerk} ${nomClerk}`.trim());\r\n      formData.set(\"email\", emailClerk);\r\n      if (fileInput.current?.files && fileInput.current.files.length > 5) {\r\n        setResult(\"Vous ne pouvez joindre que 5 fichiers maximum.\");\r\n        setLoading(false);\r\n        return;\r\n      }\r\n      const res = await fetch(\"/api/absence/want\", {\r\n        method: \"POST\",\r\n        body: formData,\r\n      });\r\n      const json = await res.json();\r\n      if (!res.ok) {\r\n        setResult(json.error || \"Erreur lors de l'envoi.\");\r\n      } else {\r\n        setResult(json.message || \"Demande envoyée.\");\r\n        if (fileInput.current) fileInput.current.value = \"\";\r\n        form.reset();\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Erreur envoi formulaire:\", err);\r\n      setResult(\"Erreur serveur.\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n  if (!isLoaded) return <div>Chargement…</div>;\r\n  if (!user) return <div>Vous devez être connecté(e).</div>;\r\n  const prenomClerk = user.firstName || \"\";\r\n  const nomClerk = user.lastName || \"\";\r\n  const emailClerk =\r\n    user.primaryEmailAddress?.emailAddress ||\r\n    user.emailAddresses?.[0]?.emailAddress ||\r\n    \"\";\r\n\r\n  return (\r\n    <form\r\n      onSubmit={handleSubmit}\r\n      encType=\"multipart/form-data\"\r\n      className=\"pt-[20vh] flex flex-col items-center gap-4\"\r\n    >\r\n      <h2>Déclaration d’absence</h2>\r\n      <label>\r\n        Prénom&nbsp;:\r\n        <input type=\"text\" value={prenomClerk} readOnly tabIndex={-1} style={{ background: \"#f5f5f5\" }} />\r\n      </label>\r\n      <label>\r\n        Nom&nbsp;:\r\n        <input type=\"text\" value={nomClerk} readOnly tabIndex={-1} style={{ background: \"#f5f5f5\" }} />\r\n      </label>\r\n      <label>\r\n        Email&nbsp;:\r\n        <input type=\"email\" value={emailClerk} readOnly tabIndex={-1} style={{ background: \"#f5f5f5\" }} />\r\n      </label>\r\n      <input type=\"hidden\" name=\"nom\" value={`${prenomClerk} ${nomClerk}`.trim()} readOnly />\r\n      <input type=\"hidden\" name=\"email\" value={emailClerk} readOnly />\r\n      <label>\r\n        Je suis&nbsp;:\r\n        <select name=\"type\" required>\r\n          <option value=\"\">Choisir…</option>\r\n          <option value=\"prof\">Professeur</option>\r\n          <option value=\"salarie\">Personnel/salarié</option>\r\n        </select>\r\n      </label>\r\n      <label>\r\n        Établissement concerné&nbsp;:\r\n        <select name=\"cible\" required>\r\n          <option value=\"\">Choisir…</option>\r\n          <option value=\"direction_ecole\">École</option>\r\n          <option value=\"direction_college\">Collège</option>\r\n          <option value=\"direction_lycee\">Lycée</option>\r\n        </select>\r\n      </label>\r\n      <label>\r\n        Début&nbsp;: <input type=\"date\" name=\"date_debut\" required />\r\n      </label>\r\n      <label>\r\n        Fin&nbsp;: <input type=\"date\" name=\"date_fin\" required />\r\n      </label>\r\n      <label>\r\n        Motif d’absence&nbsp;:\r\n        <input type=\"text\" name=\"motif\" required />\r\n      </label>\r\n      <label>\r\n        Justificatifs (5 max)&nbsp;:\r\n        <input\r\n          type=\"file\"\r\n          name=\"attachments\"\r\n          ref={fileInput}\r\n          multiple\r\n          accept=\"image/*,.pdf\"\r\n        />\r\n      </label>\r\n      <label>\r\n        Commentaire :\r\n        <textarea name=\"commentaire\" />\r\n      </label>\r\n      <button type=\"submit\" disabled={loading} style={{ marginTop: 15 }}>\r\n        {loading ? \"Envoi...\" : \"Déclarer mon absence\"}\r\n      </button>\r\n      {result && <div style={{ marginTop: 12 }}>{result}</div>}\r\n    </form>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}