{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/f.hacqueville/OneDrive%20-%20LYCEE%20LA%20PROVIDENCE%20NICOLAS%20BARRE/Code/docsLaPro/app/prof-room/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { useUser } from \"@clerk/nextjs\";\r\n\r\nconst FRENCH_HOLIDAYS_2025 = [\"2025-01-01\",\"2025-04-21\",\"2025-05-01\",\"2025-05-08\",\"2025-05-29\",\"2025-06-09\",\"2025-07-14\",\"2025-08-15\",\"2025-11-01\",\"2025-11-11\",\"2025-12-25\"];\r\n\r\nfunction isWeekend(date: Date) {\r\n  const d = date.getDay();\r\n  return d === 0 || d === 6;\r\n}\r\n\r\nconst HOURS = Array.from({ length: 11 }, (_, i) => 8 + i);\r\n\r\nexport default function ProfRoomPage() {\r\n  const { user, isLoaded } = useUser();\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  const [rooms, setRooms] = useState<any[]>([]);\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  const [reservations, setReservations] = useState<any[]>([]);\r\n  const [selectedRoom, setSelectedRoom] = useState(\"\");\r\n  const [selectedDate, setSelectedDate] = useState(\"\");\r\n  const [selectedHour, setSelectedHour] = useState<number | null>(null);\r\n  const ADMIN_LASTNAMES = [\"Hacqueville-Mathi\", \"Dupont\", \"Martin\"];\r\n  const lastName = user?.lastName ?? \"\";\r\n  useEffect(() => {\r\n    async function load() {\r\n      const roomsRes = await fetch(\"/api/reservation-rooms/rooms\");\r\n      const roomsData = await roomsRes.json();\r\n      setRooms(roomsData.rooms || []);\r\n      const resRes = await fetch(\"/api/reservation-rooms/reservations\");\r\n      const resData = await resRes.json();\r\n      setReservations(resData.reservations || []);\r\n    }\r\n    load();\r\n  }, []);\r\n  if (!isLoaded) return <p>Chargement...</p>;\r\n  if (!user) return <p>Veuillez vous connecter</p>;\r\n  function getReservation(hour: number) {\r\n    return reservations.find(\r\n      (r) =>\r\n        r.roomId === selectedRoom &&\r\n        r.startsAt.startsWith(selectedDate) &&\r\n        new Date(r.startsAt).getHours() === hour\r\n    );\r\n  }\r\n  async function handleConfirm() {\r\n    if (selectedHour === null || !selectedRoom || !selectedDate) return;\r\n    const start = new Date(`${selectedDate}T${selectedHour.toString().padStart(2, \"0\")}:00`);\r\n    if (isWeekend(start) || FRENCH_HOLIDAYS_2025.includes(selectedDate)) {\r\n      alert(\"‚õîÔ∏è Impossible de r√©server un week-end ou jour f√©ri√©.\");\r\n      return;\r\n    }\r\n    const end = new Date(start.getTime() + 60 * 60 * 1000);\r\n    const res = await fetch(\"/api/reservation-rooms/reservations/create\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        roomId: selectedRoom,\r\n        startsAt: start.toISOString(),\r\n        endsAt: end.toISOString(),\r\n        firstName: user!.firstName || \"\",\r\n        lastName: user!.lastName || \"\",\r\n      }),\r\n    });\r\n    if (res.ok) {\r\n      alert(\"‚úÖ R√©servation confirm√©e !\");\r\n      setReservations([\r\n        ...reservations,\r\n        {\r\n          roomId: selectedRoom,\r\n          startsAt: start.toISOString(),\r\n          firstName: user!.firstName || \"\",\r\n          lastName: user!.lastName || \"\",\r\n        },\r\n      ]);\r\n      setSelectedHour(null);\r\n    } else {\r\n      const err = await res.json();\r\n      alert(\"Erreur : \" + (err.error || \"inconnue\"));\r\n    }\r\n  }\r\n  async function handleDeleteReservation(startIso: string) {\r\n    if (!confirm(\"Supprimer cette r√©servation ?\")) return;\r\n    const res = await fetch(\"/api/reservation-rooms/reservations/delete\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ startsAt: startIso }),\r\n    });\r\n    if (res.ok) {\r\n      alert(\"üóëÔ∏è R√©servation annul√©e\");\r\n      setReservations(reservations.filter((r) => r.startsAt !== startIso));\r\n    } else {\r\n      const err = await res.json();\r\n      alert(\"Erreur : \" + (err.error || \"inconnue\"));\r\n    }\r\n  }\r\n  async function downloadJSON() {\r\n    const res = await fetch(\"/api/reservation-rooms/reservations\");\r\n    const data = await res.json();\r\n    const blob = new Blob([JSON.stringify(data, null, 2)], {type: \"application/json\",});\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement(\"a\");\r\n    a.href = url;\r\n    a.download = \"reservations.json\";\r\n    a.click();\r\n    URL.revokeObjectURL(url);\r\n  }\r\n  return (\r\n    <div className=\"p-8 max-w-xl mx-auto\">\r\n      <h1 className=\"text-2xl font-bold mb-6\">R√©server une salle</h1>\r\n      {(ADMIN_LASTNAMES.includes(lastName)) && (\r\n        <button onClick={downloadJSON} className=\"mb-6 px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700\">T√©l√©charger la base de donn√©es des r√©servations (JSON)</button>\r\n      )}\r\n      <div className=\"mb-4\">\r\n        <label className=\"block mb-1 font-medium\">Salle</label>\r\n        <select  value={selectedRoom} onChange={(e) => setSelectedRoom(e.target.value)} className=\"border rounded w-full p-2\">\r\n          <option value=\"\">-- Choisir une salle --</option>\r\n          {rooms.map((r) => (\r\n            <option key={r.id} value={r.id}>{r.name}</option>\r\n          ))}\r\n        </select>\r\n      </div>\r\n      <div className=\"mb-6\">\r\n        <label className=\"block mb-1 font-medium\">Date</label>\r\n        <input type=\"date\" value={selectedDate} min={new Date().toISOString().split(\"T\")[0]} onChange={(e) => setSelectedDate(e.target.value)} className=\"border rounded w-full p-2\"/>\r\n      </div>\r\n      {selectedRoom && selectedDate && (\r\n        <>\r\n          <div className=\"grid grid-cols-4 gap-2 mb-4\">\r\n            {HOURS.map((hour) => {\r\n              const res = getReservation(hour);\r\n              const isBooked = !!res;\r\n              const isSelected = selectedHour === hour;\r\n              return (\r\n                <div key={hour} className=\"flex flex-col gap-1\">\r\n                  <button disabled={isBooked}  onClick={() => setSelectedHour(hour)}  className={`p-2 rounded text-white ${ isBooked ? \"bg-gray-400 cursor-not-allowed\" : isSelected ? \"bg-green-600 hover:bg-green-700\" : \"bg-blue-600 hover:bg-blue-700\"}`}>\r\n                    {hour}:00 - {hour + 1}:00\r\n                    {isBooked ? ` (${res.firstName} ${res.lastName})` : \"\"}\r\n                  </button>\r\n                  {isBooked && (ADMIN_LASTNAMES.includes(lastName)) && (\r\n                    <button onClick={() => handleDeleteReservation(res.startsAt)} className=\"text-xs bg-red-600 text-white p-1 rounded hover:bg-red-700\">Annuler</button>\r\n                  )}\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n          {selectedHour !== null && (\r\n            <button onClick={handleConfirm} className=\"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700\">Confirmer la r√©servation ({selectedHour}:00 - {selectedHour + 1}:00)</button>\r\n          )}\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}