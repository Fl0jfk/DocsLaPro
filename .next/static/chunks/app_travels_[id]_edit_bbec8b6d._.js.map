{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/f.hacqueville/OneDrive%20-%20LYCEE%20LA%20PROVIDENCE%20NICOLAS%20BARRE/Code/docsLaPro/app/travels/%5Bid%5D/edit/form.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState, useRef } from \"react\";\r\nimport { useUser } from \"@clerk/nextjs\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\nexport default function VoyageEditForm({ voyageId }: { voyageId: string }) {\r\n  const { user, isLoaded } = useUser();\r\n  const router = useRouter();\r\n  const [voyage, setVoyage] = useState<any | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n    type FormValues = {\r\n  lieu: string;\r\n  activite: string;\r\n  date_depart: string;\r\n  date_retour: string;\r\n  classes: string;\r\n  effectif_eleves: number;\r\n  effectif_accompagnateurs: number;\r\n  commentaire: string;\r\n};\r\n\r\nconst [formValues, setFormValues] = useState<FormValues | null>(null);\r\n  const progInput = useRef<HTMLInputElement | null>(null);\r\n  const filesInput = useRef<HTMLInputElement | null>(null);\r\n\r\n  useEffect(() => {\r\n    console.log(\"useEffect lancé\", { isLoaded, user, voyageId });\r\n    if (!isLoaded || !user) return;\r\n\r\n    const fetchVoyage = async () => {\r\n      try {\r\n        console.log(\"fetchVoyage appelé pour id:\", voyageId);\r\n        const res = await fetch(`/api/travels/get?voyageId=${voyageId}`);\r\n        console.log(\"Réponse API:\", res.status);\r\n        if (!res.ok) throw new Error(\"Voyage introuvable\");\r\n        const data = await res.json();\r\n        console.log(\"Voyage reçu:\", data);\r\n        setVoyage(data);\r\n\r\n        setFormValues({\r\n          lieu: data.lieu,\r\n          activite: data.activite,\r\n          date_depart: data.date_depart,\r\n          date_retour: data.date_retour,\r\n          classes: data.classes,\r\n          effectif_eleves: data.effectif_eleves,\r\n          effectif_accompagnateurs: data.effectif_accompagnateurs,\r\n          commentaire: data.commentaire || \"\",\r\n        });\r\n      } catch (err: any) {\r\n        console.error(\"Erreur fetchVoyage:\", err);\r\n        setError(err.message);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchVoyage();\r\n  }, [isLoaded, user, voyageId]);\r\n\r\n  if (!isLoaded) return <div>Chargement utilisateur…</div>;\r\n  if (!user) return <div>Veuillez vous connecter.</div>;\r\n  if (loading) return <div>Chargement du voyage…</div>;\r\n  if (error) return <div className=\"text-red-600\">{error}</div>;\r\n  if (!voyage || !formValues) return <div>Voyage introuvable ou formulaire vide.</div>;\r\n\r\n\r\nconst handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\r\n  setFormValues((prev: FormValues | null) => {\r\n    if (!prev) return prev;\r\n    return { ...prev, [e.target.name]: e.target.value };\r\n  });\r\n};\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setSaving(true);\r\n    console.log(\"handleSubmit appelé\", formValues);\r\n\r\n    try {\r\n      const newProgramme = progInput.current?.files?.[0]\r\n        ? { filename: progInput.current.files[0].name, url: \"TODO_upload\" }\r\n        : voyage.programme;\r\n\r\n      const newPJ = filesInput.current?.files\r\n        ? Array.from(filesInput.current.files).map(f => ({ filename: f.name, url: \"TODO_upload\" }))\r\n        : voyage.pieces_jointes || [];\r\n\r\n      const body = { ...voyage, ...formValues, programme: newProgramme, pieces_jointes: newPJ };\r\n      console.log(\"Données envoyées à update API:\", body);\r\n\r\n      const res = await fetch(`/api/travels/update?voyageId=${voyageId}`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify(body),\r\n      });\r\n\r\n      console.log(\"Réponse update API:\", res.status);\r\n      if (!res.ok) {\r\n        const json = await res.json();\r\n        throw new Error(json.error || \"Erreur lors de la mise à jour\");\r\n      }\r\n\r\n      router.push(\"/travels\");\r\n    } catch (err: any) {\r\n      console.error(\"Erreur update voyage:\", err);\r\n      setError(err.message);\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className=\"pt-[15vh] flex flex-col gap-4 max-w-xl mx-auto\">\r\n      <h2 className=\"text-xl font-bold mb-4\">Modifier le voyage</h2>\r\n\r\n      <label>\r\n        Lieu / destination :\r\n        <input name=\"lieu\" value={formValues.lieu} onChange={handleChange} required />\r\n      </label>\r\n\r\n      <label>\r\n        Activité / motif :\r\n        <input name=\"activite\" value={formValues.activite} onChange={handleChange} required />\r\n      </label>\r\n\r\n      <label>\r\n        Date de départ :\r\n        <input type=\"date\" name=\"date_depart\" value={formValues.date_depart} onChange={handleChange} required />\r\n      </label>\r\n\r\n      <label>\r\n        Date de retour :\r\n        <input type=\"date\" name=\"date_retour\" value={formValues.date_retour} onChange={handleChange} required />\r\n      </label>\r\n\r\n      <label>\r\n        Classes concernées :\r\n        <input name=\"classes\" value={formValues.classes} onChange={handleChange} required />\r\n      </label>\r\n\r\n      <label>\r\n        Nombre d’élèves :\r\n        <input type=\"number\" name=\"effectif_eleves\" min={1} value={formValues.effectif_eleves} onChange={handleChange} required />\r\n      </label>\r\n\r\n      <label>\r\n        Nombre d’accompagnateurs :\r\n        <input type=\"number\" name=\"effectif_accompagnateurs\" min={1} value={formValues.effectif_accompagnateurs} onChange={handleChange} required />\r\n      </label>\r\n\r\n      <label>\r\n        Programme (PDF ou image) :\r\n        <input ref={progInput} type=\"file\" accept=\".pdf,.doc,.docx,image/*\" />\r\n      </label>\r\n\r\n      <label>\r\n        Autres pièces jointes :\r\n        <input ref={filesInput} type=\"file\" multiple accept=\"image/*,.pdf\" />\r\n      </label>\r\n\r\n      <label>\r\n        Commentaire :\r\n        <textarea name=\"commentaire\" value={formValues.commentaire} onChange={handleChange} />\r\n      </label>\r\n\r\n      <button type=\"submit\" disabled={saving} className=\"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700\">\r\n        {saving ? \"Enregistrement…\" : \"Mettre à jour\"}\r\n      </button>\r\n\r\n      {error && <p className=\"text-red-600 mt-2\">{error}</p>}\r\n    </form>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 406, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/f.hacqueville/OneDrive%20-%20LYCEE%20LA%20PROVIDENCE%20NICOLAS%20BARRE/Code/docsLaPro/app/travels/%5Bid%5D/edit/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { use } from \"react\";\r\nimport VoyageEditForm from \"./form\";\r\n\r\n// On dit clairement que params est une Promise ou un objet\r\nexport default function VoyageEditPage({\r\n  params,\r\n}: {\r\n  params: { id: string } | Promise<{ id: string }>;\r\n}) {\r\n  // Résolution garantie\r\n  const resolvedParams: { id: string } = use(params as Promise<{ id: string }> | { id: string });\r\n  const voyageId = resolvedParams.id;\r\n\r\n  return <VoyageEditForm voyageId={voyageId} />;\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;AACA;AAFA;;;;AAKe,SAAS,eAAe,KAItC;QAJsC,EACrC,MAAM,EAGP,GAJsC;IAKrC,sBAAsB;IACtB,MAAM,iBAAiC,IAAA,oKAAG,EAAC;IAC3C,MAAM,WAAW,eAAe,EAAE;IAElC,qBAAO,6LAAC,uJAAc;QAAC,UAAU;;;;;;AACnC;KAVwB","debugId":null}}]
}