version: 1
applications:
  - frontend:
      phases:
        preBuild:
          commands:
            - npm ci
        build:
          commands:
            # Injecte toutes tes variables Amplify dans le .env.production
            - echo "ACCESS_KEY_ID=$ACCESS_KEY_ID" >> .env.production
            - echo "BUCKET_NAME=$BUCKET_NAME" >> .env.production
            - echo "CLERK_SECRET_KEY=$CLERK_SECRET_KEY" >> .env.production
            - echo "MISTRAL_API_KEY=$MISTRAL_API_KEY" >> .env.production
            - echo "NEXT_PUBLIC_APP_URL=$NEXT_PUBLIC_APP_URL" >> .env.production
            - echo "NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=$NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY" >> .env.production
            - echo "REGION=$REGION" >> .env.production
            - echo "SECRET_ACCESS_KEY=$SECRET_ACCESS_KEY" >> .env.production
            - echo "SMTP_MAIL=$SMTP_MAIL" >> .env.production
            - echo "SMTP_PASS=$SMTP_PASS" >> .env.production
            - echo "SMTP_USER=$SMTP_USER" >> .env.production
            # Ajoute ici toutes les autres variables dont tu as besoin
            - npm run build
      artifacts:
        baseDirectory: .next
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*

